/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package xml;
 /**
 * @author Jason Ndemueda<jndemueda@intrahealth.org><ndemuedajason@gmail.com>
 * 
 * COPYRIGHT NOTICE
 * Namibian Automatic WISN Loader (NAWL), a program developed by IntraHealth International (<intrahealth@intrahealth.org>)
 * to import service statistics into the WISN tool developed by WHO (<hrhinfo@who.int>).
 * 
 * Copyright (C) 2012 IntraHealth International
 * 
 * STATEMENT OF COPYRIGHT PERMISSION
 * This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied 
 * warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License along with this program.  If not, see 
 * <http://www.gnu.org/licenses/>.
 * 
 */
import java.io.File;
import java.io.IOException;

public class CreateWatFile {
    private XMLFile xmlfile;
    private XMLDocument xmldocument;
    private LoopingXMLDocument loop;// class just to loop the xml for answers
    private Constants constants;
    public ReadOPD opdDoc;
    private ReadExistingStaff existingStaffDoc;
    private ReadXLS excelDoc;
    private Facility[] facilities;
    private Activity[] activities;
    private ExistingStaff[] existingStaff;
    private int numberOfRows;
    
    public void loadingExcelFile( String excelFileName ) throws IOException {        
        readMainFile(excelFileName);  
//        readOPD();
    }
    
    public void readMainFile(String main) throws IOException {
        excelDoc = new ReadXLS();
        excelDoc.setInputFile(main);
        excelDoc.read();
        numberOfRows = excelDoc.getRowLength();
        setFacilities(excelDoc.getFacilities());
        //System.out.println(facilities[1].getInstitutionName());
    }
    
    public void readOPD() throws IOException {
        opdDoc = new ReadOPD();
        opdDoc.setInputFile("SNIS.xls");
        opdDoc.read();
        numberOfRows = opdDoc.getRowLength();
        
        /*REPORT TO LOG FILE*/
        LogFile.setNumberRowsOPD(numberOfRows);
        /*END REPORT*/
        
        setActivities(opdDoc.getActivities());
        //System.out.println(facilities[1].getInstitutionName());
    }
    
    public void readExistingStaff() throws IOException {
        existingStaffDoc = new ReadExistingStaff();
        existingStaffDoc.setInputFile("RHS.xls");
        existingStaffDoc.read();
        numberOfRows = existingStaffDoc.getRowLength();
        setExistingStaff(existingStaffDoc.getExistingStaff());
        //System.out.println(facilities[1].getInstitutionName());
    }
    
    public void enablingXMLFile(String inFileName,String outFileName, String xmlTemplate){
        xmlfile = new XMLFile(inFileName, outFileName);
        xmlfile.readFile();
//        if( xmlTemplate.compareToIgnoreCase(INSTITUTIONDESCRIPTION.PRIMARYHEALTHCENTREWITHBEDS) == 0 )
//            xmldocument = new XMLDocument (xmlfile.getDoc(), new Template(INSTITUTIONDESCRIPTION.PRIMARYHEALTHCENTREWITHBEDS));
//        if( xmlTemplate.compareToIgnoreCase(INSTITUTIONDESCRIPTION.PRIMARYHEALTHCENTREWITHOUTBEDS) == 0 )
//            xmldocument = new XMLDocument(xmlfile.getDoc(), new Template(INSTITUTIONDESCRIPTION.PRIMARYHEALTHCENTREWITHOUTBEDS));
        if( xmlTemplate.compareToIgnoreCase(INSTITUTIONDESCRIPTION.DISTRICTGENERALHOSPITAL) == 0 )
            xmldocument = new XMLDocument(xmlfile.getDoc(), new Template(INSTITUTIONDESCRIPTION.DISTRICTGENERALHOSPITAL));
        if( xmlTemplate.compareToIgnoreCase(INSTITUTIONDESCRIPTION.PRIMARYHEALTHCENTREWITHBEDS) == 0 )
            xmldocument = new XMLDocument(xmlfile.getDoc(), new Template(INSTITUTIONDESCRIPTION.PRIMARYHEALTHCENTREWITHBEDS));
        //xmldocument = new XMLDocument(xmlfile.getDoc(), new Template(INSTITUTIONDESCRIPTION.PRIMARYHEALTHCENTREWITHBEDS));
        loop = new LoopingXMLDocument(xmlfile.getDoc());
        constants = new Constants();//For district id                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
    }
    
    public void changingDetailsPerFacility(Facility f){
        String name=f.getInstitutionName();
        xmldocument.changeRegion(f.getRegion(),constants.getRegionID(f.getRegion()));
        xmldocument.changeDistrict(f.getDistrict(),constants.getDistrictID(f.getDistrict()));
        //System.out.println(f.getDistrict());
        xmldocument.changeInstitutionName(f.getInstitutionName());
        //System.out.println(f.getInstitutionName());
        xmldocument.changeInstitutionType(f.getInstitutionType(),constants.getInstitutionTypeID(f.getInstitutionType()));
        xmldocument.changeInstitutionDescription(f.getInstitutionDescription(), constants.getInstitutionDescriptionID(f.getInstitutionDescription()));
        xmlfile.writeFile(xmldocument.getDoc());
        
        /*REPORT TO LOG FILE*/
        LogFile.increaseNumberFilesCreated();
        /*END OF REPORT*/
    }

    
    public void traiter_HGR( int i, CreateWatFile f, String fileNameFormat,String regionName ) throws IOException {
        //check if the region directory exists:if not create it
        String dir="DPS_"+regionName;
        
        File file=new File(dir);
        
        boolean b=false;

        if(!file.exists()){
            
            b=file.mkdirs();
            
            if(b){
                System.out.println("Dossier "+dir+" cr avec succs");
            }else{
                System.out.println("Impossible de crer le dossier "+dir);
                return;
            }
        }
        
        String subdir=dir+"//HGR";
        
        file=new File(subdir);
        
        if(!file.exists()){
            b=file.mkdirs();
            if(b){
                System.out.println("Sous dossier HGR cr avec succs");
            }else{
                System.out.println("Impossible de crer le dossier HGR");
            }
        }
//        f.enablingXMLFile("provincial//provincial.xml","provincial//"+fileNameFormat, INSTITUTIONDESCRIPTION.DISTRICTGENERALHOSPITAL); 
//        f.enablingXMLFile(dir+"//HGR//provincial.xml",dir+"//HGR//"+fileNameFormat, INSTITUTIONDESCRIPTION.DISTRICTGENERALHOSPITAL);
        f.enablingXMLFile("HGR//template_hgr.xml",dir+"//HGR//"+fileNameFormat, INSTITUTIONDESCRIPTION.DISTRICTGENERALHOSPITAL);
        f.getLoop().numberOfTickedCadres();
        f.getLoop().getTickedCadresIDs();
        f.getLoop().getAllActivitiesAllCadres();
        f.readOPD();
        Activity[] arr = f.opdDoc.getActivities();//System.out.println("*** "+m.getFacilities()[i].getInstitutionName()+" ***\n");
        
        /*REPORT TO LOG FILE*/
        LogFile.setFoundOPD(false);//TO TRACK IF THE OPD OF THE FACILITY IS UPDATED
        /*END REPORT*/
        
        /* TO LOOP THROUGH ALL THE ACTIVITIES IN THE OPD.xls file
         * CHECKS IF THE FACILITY IN THE all_regions.xls can be found in the OPD.xls
         * Loop the OPD.xls once per facility
         * Number of loops = number of rows in all_regions.xls * number of rows in the OPD.xls           
         */         
        for( int j=1; j<arr.length; j++ ){
            //System.out.println(arr[j].getActivity());
//            System.out.println(arr[j].getInstitutionName()+" "+f.getFacilities()[i].getInstitutionName());
            
            if( arr[j].getActivity() != null ){
                if( arr[j].getInstitutionName().compareToIgnoreCase(f.getFacilities()[i].getInstitutionName()) == 0){
                    if( f.getLoop().isActivityListed(arr[j].getCadre(), arr[j].getActivity())){
                        f.getLoop().changeActivity(arr[j].getCadre(), arr[j].getActivity(), arr[j].getValue());
                        /*REPORT*/
                        LogFile.setFoundOPD(true);//OPD OF THE FACILITY WAS CORRECTLY UPDATED        
                        /*END REPORT*/
                    }
                }
            }
        } 
        
        /* TO LOOP THROUGH ALL THE ROWS IN THE ES.xls file
         * CHECKS IF THE FACILITY IN THE all_regions.xls can be found in the ES.xls
         * Loop the ES.xls once per facility
         * Number of loops = number of rows in all_regions.xls * number of rows in the ES.xls           
         */
        f.readExistingStaff();
        ExistingStaff[] arrEs = f.existingStaffDoc.getExistingStaff();
        /*REPORT TO LOG FILE*/
        LogFile.setFoundES(false);//TO TRACK IF THE EXISTING STAFF OF THE FACILITY IS UPDATED
        /*END REPORT*/
        // TO CHANGE EXISTING STAFF
        for( int j=1; j<arrEs.length; j++ ){
            //System.out.println(arr[j].getActivity());
            if( arrEs[j].getInstitutionName() != null ){// IF A ROW IS NOT EMPTY
                if( arrEs[j].getInstitutionName().compareToIgnoreCase(f.getFacilities()[i].getInstitutionName()) == 0){
                    if( f.getLoop().isCadreListed(arrEs[j].getCadreName())){// THE FILTER WORKS!!!
                        f.getLoop().changeExistingStaff(arrEs[j].getCadreName(), arrEs[j].getValue());
                        //REPORT
                        LogFile.setFoundES(true);
                        //END REPORT
                    }
                        
                }
            }
        }
        
        /*REPORT TO LOG FILE*/
        if( LogFile.isFoundOPD() && LogFile.isFoundES()){
            
            System.out.println((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName());            
            LogFile.appendListOfFacilitiesCreated((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName());            
            LogFile.increaseCountOpdUpdatedCorrectly();
            LogFile.increaseCountESUpdatedCorrectly();
            
        }else if( LogFile.isFoundOPD() && LogFile.isFoundES() == false ){
            
            System.out.println((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName()+ "++++++++++++++++++++++++++++++" +"\n\tExisting Staff not updated");            
            LogFile.appendListOfFacilitiesCreated((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName()+ "++++++++++++++++++++++++++++++" +"\n\tExisting Staff not updated");            
            LogFile.increaseCountOpdUpdatedCorrectly();//true
            LogFile.increaseCountESNotUpdated();//false
            
        }else if( LogFile.isFoundOPD() == false && LogFile.isFoundES()){
            
            System.out.println((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName()+ "******************************" +"\n\tOPD not updated");            
            LogFile.appendListOfFacilitiesCreated((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName()+ "******************************" +"\n\tOPD not updated");            
            LogFile.increaseCountOpdNotUpdated();//false
            LogFile.increaseCountESUpdatedCorrectly();//true
        }
            
        
        else if( LogFile.isFoundOPD() == false && LogFile.isFoundES() == false ){
            System.out.println((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName()+ "##############################" +"\n\tOPD not updated\n\tExisting Staff not updated");
            LogFile.appendListOfFacilitiesCreated((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName()+ "##############################" +"\n\tOPD not updated\n\tExisting Staff not updated");
            LogFile.increaseCountOpdNotUpdated();//false
            LogFile.increaseCountESNotUpdated();//false
        }
        /*END REPORT*/        
        
        f.changingDetailsPerFacility(f.getFacilities()[i]);
    }
    
    public void traiter_CS( int i, CreateWatFile f, String fileNameFormat,
            String regionName,String districtName ) throws IOException {
        
        String dir="DPS_"+regionName;
        
        String subdir=dir+"//CS//ZS_"+districtName;
        
        File file1=new File(dir);
        
        boolean b=false;
        
        if(!file1.exists()){
            
            b=file1.mkdirs();
            
            if(b){
                System.out.println("Dossier "+dir+" cr avec succs");
            }else{
                System.out.println("Impossible de crer le dossier "+dir);
                return;
            }
        }
        
        b =false;
        
        File file2=new File(subdir);
        
        if(!file2.exists()){
            
            b=file2.mkdirs();
            
            if(b){
                System.out.println("Sous dossier "+subdir+" cr avec succs dans le repertoire "+dir);
            }else{
                System.out.println("Impossible de crer le dossier "+subdir+" dans le repertoire "+dir);
                return;
            }
        }
        
//        f.enablingXMLFile("central//central.xml","central//"+fileNameFormat, INSTITUTIONDESCRIPTION.PRIMARYHEALTHCENTREWITHBEDS);
//        f.enablingXMLFile(dir+"//CS//central.xml",subdir+"//"+fileNameFormat, INSTITUTIONDESCRIPTION.PRIMARYHEALTHCENTREWITHBEDS);
        f.enablingXMLFile("CS//template_cs.xml",subdir+"//"+fileNameFormat, INSTITUTIONDESCRIPTION.PRIMARYHEALTHCENTREWITHBEDS);
        f.getLoop().numberOfTickedCadres();
        f.getLoop().getTickedCadresIDs();
        f.getLoop().getAllActivitiesAllCadres();
        f.readOPD();
        Activity[] arr = f.opdDoc.getActivities();//System.out.println("*** "+m.getFacilities()[i].getInstitutionName()+" ***\n");
        
        /*REPORT TO LOG FILE*/
        LogFile.setFoundOPD(false);//TO TRACK IF THE OPD OF THE FACILITY IS UPDATED
        /*END REPORT*/
        
        /* TO LOOP THROUGH ALL THE ACTIVITIES IN THE OPD.xls file
         * CHECKS IF THE FACILITY IN THE all_regions.xls can be found in the OPD.xls
         * Loop the OPD.xls once per facility
         * Number of loops = number of rows in all_regions.xls * number of rows in the OPD.xls           
         */         
        for( int j=1; j<arr.length; j++ ){
            //System.out.println(arr[j].getActivity());
            if( arr[j].getActivity() != null ){
                
//                System.out.println(arr[j].getInstitutionName()+" "+f.getFacilities()[i].getInstitutionName());
                
                if( arr[j].getInstitutionName().compareToIgnoreCase(f.getFacilities()[i].getInstitutionName()) == 0){
                    if( f.getLoop().isActivityListed(arr[j].getCadre(), arr[j].getActivity())){
                        f.getLoop().changeActivity(arr[j].getCadre(), arr[j].getActivity(), arr[j].getValue());
                        /*REPORT*/
                        LogFile.setFoundOPD(true);//OPD OF THE FACILITY WAS CORRECTLY UPDATED        
                        /*END REPORT*/
                    }
                }
            }
        }     
        
        
        /* TO LOOP THROUGH ALL THE ROWS IN THE ES.xls file
         * CHECKS IF THE FACILITY IN THE all_regions.xls can be found in the ES.xls
         * Loop the ES.xls once per facility
         * Number of loops = number of rows in all_regions.xls * number of rows in the ES.xls           
         */
        f.readExistingStaff();
        ExistingStaff[] arrEs = f.existingStaffDoc.getExistingStaff();
        /*REPORT TO LOG FILE*/
        LogFile.setFoundES(false);//TO TRACK IF THE EXISTING STAFF OF THE FACILITY IS UPDATED
        /*END REPORT*/
        // TO CHANGE EXISTING STAFF
        for( int j=1; j<arrEs.length; j++ ){
            //System.out.println(arr[j].getActivity());
            if( arrEs[j].getInstitutionName() != null ){// IF A ROW IS NOT EMPTY
                if( arrEs[j].getInstitutionName().compareToIgnoreCase(f.getFacilities()[i].getInstitutionName()) == 0){
                    if( f.getLoop().isCadreListed(arrEs[j].getCadreName())){// THE FILTER WORKS!!!
                        f.getLoop().changeExistingStaff(arrEs[j].getCadreName(), arrEs[j].getValue());
                        //REPORT
                        LogFile.setFoundES(true);
                        //END REPORT
                    }
                        
                }
            }
        }
        
        /*REPORT TO LOG FILE*/
        if( LogFile.isFoundOPD() && LogFile.isFoundES()){
            
            System.out.println((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName());            
            LogFile.appendListOfFacilitiesCreated((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName());            
            LogFile.increaseCountOpdUpdatedCorrectly();
            LogFile.increaseCountESUpdatedCorrectly();
            
        }else if( LogFile.isFoundOPD() && LogFile.isFoundES() == false ){
            
            System.out.println((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName()+ "++++++++++++++++++++++++++++++" +"\n\tExisting Staff not updated");            
            LogFile.appendListOfFacilitiesCreated((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName()+ "++++++++++++++++++++++++++++++" +"\n\tExisting Staff not updated");            
            LogFile.increaseCountOpdUpdatedCorrectly();//true
            LogFile.increaseCountESNotUpdated();//false
            
        }else if( LogFile.isFoundOPD() == false && LogFile.isFoundES()){
            
            System.out.println((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName()+ "******************************" +"\n\tOPD not updated");            
            LogFile.appendListOfFacilitiesCreated((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName()+ "******************************" +"\n\tOPD not updated");            
            LogFile.increaseCountOpdNotUpdated();//false
            LogFile.increaseCountESUpdatedCorrectly();//true
        }
            
        
        else if( LogFile.isFoundOPD() == false && LogFile.isFoundES() == false ){
            System.out.println((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName()+ "##############################" +"\n\tOPD not updated\n\tExisting Staff not updated");
            LogFile.appendListOfFacilitiesCreated((LogFile.getNumberFilesCreated() + 1)+" - "+f.getFacilities()[i].getInstitutionName()+ "##############################" +"\n\tOPD not updated\n\tExisting Staff not updated");
            LogFile.increaseCountOpdNotUpdated();//false
            LogFile.increaseCountESNotUpdated();//false
        }
        /*END REPORT*/
        
        f.changingDetailsPerFacility(f.getFacilities()[i]);
    }
    
    
    public static void main(String argv[]) throws IOException {
        
        CreateWatFile m = new CreateWatFile();
        m.loadingExcelFile("PYRAMIDE.xls");        
        //m.readOPD();
        int i;        
        int length = m.getNumberOfRows();
        
        //m.getLoop().getTickedCadresID();
        for( i = 1 ; i < length ; i++){
            String regionCode = m.getFacilities()[i].getRegionCode()+"_";
            String code = m.getFacilities()[i].getCode()+"_";
            String facilityName = m.getFacilities()[i].getInstitutionName().replaceAll("\\s", "");
            String extention = ".wat";
            String fileNameFormat = regionCode+code+facilityName+extention;
            //System.out.println("facilities//"+"delete.wat");
//            if( m.getFacilities()[i].getInstitutionDescription().compareToIgnoreCase(INSTITUTIONDESCRIPTION.PRIMARYHEALTHCENTREWITHBEDS) == 0 ){
//                //m.primaryHeathCentreWithBeds( i, m , fileNameFormat );
//            }
//            else if( m.getFacilities()[i].getInstitutionDescription().compareToIgnoreCase(INSTITUTIONDESCRIPTION.PRIMARYHEALTHCENTREWITHOUTBEDS) == 0 ){
//                     //m.primaryHeathCentreWithoutBeds( i, m , fileNameFormat );              
//                
//                 }
            if( m.getFacilities()[i].getInstitutionDescription().compareToIgnoreCase(INSTITUTIONDESCRIPTION.DISTRICTGENERALHOSPITAL) == 0 ){
                     //m.provincialGeneralHospital(i, m, fileNameFormat);
             }
            else if( m.getFacilities()[i].getInstitutionDescription().compareToIgnoreCase(INSTITUTIONDESCRIPTION.PRIMARYHEALTHCENTREWITHBEDS) == 0 ){
                     //m.centralRegionalTertiaryHospital(i, m, fileNameFormat);
             }
                
                        
        }
        System.out.println(LogFile.getNumberFilesCreated()+" Files Created!!!");
        //LogFile.writeLog();
        //System.out.println(m);
        //m.changingDetailsPerFacility(m.getFacilities()[34]);            
        //System.out.println(m.getFacilities()[36].getDistrict());
  }

    /**
     * @return the facilities
     */
    public Facility[] getFacilities() {
        return facilities;
    }

    /**
     * @param facilities the facilities to set
     */
    public void setFacilities(Facility[] facilities) {
        this.facilities = facilities;
    }

    /**
     * @return the numberOfRows
     */
    public int getNumberOfRows() {
        return numberOfRows;
    }

    /**
     * @return the loop
     */
    public LoopingXMLDocument getLoop() {
        return loop;
    }

    /**
     * @return the activities
     */
    public Activity[] getActivities() {
        return activities;
    }

    /**
     * @param activities the activities to set
     */
    public void setActivities(Activity[] activities) {
        this.activities = activities;
    }

    /**
     * @return the existingStaffDoc
     */
    public ReadExistingStaff getExistingStaffDoc() {
        return existingStaffDoc;
    }

    /**
     * @param existingStaffDoc the existingStaffDoc to set
     */
    public void setExistingStaffDoc(ReadExistingStaff existingStaffDoc) {
        this.existingStaffDoc = existingStaffDoc;
    }

    /**
     * @return the existingStaff
     */
    public ExistingStaff[] getExistingStaff() {
        return existingStaff;
    }

    /**
     * @param existingStaff the existingStaff to set
     */
    public void setExistingStaff(ExistingStaff[] existingStaff) {
        this.existingStaff = existingStaff;
    }
 
  
}
